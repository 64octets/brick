!function(){function t(t){return JSON.parse(JSON.stringify(t))}function e(t){return t instanceof Date&&!!t.getTime&&!isNaN(t.getTime())}function n(t){return t.getUTCFullYear()}function r(t){return t.getUTCMonth()}function i(t){return t.getUTCDate()}function o(t,e){var n=t.toString(),r=new Array(e).join("0");return(r+n).substr(-e)}function a(t){return[o(n(t),4),o(r(t)+1,2),o(i(t),2)].join("-")}function s(t){if(e(t))return t;var n=v.exec(t);return n?new Date(n[1],n[2]-1,n[3]):null}function l(t){if(e(t))return t;var n=s(t);if(n)return n;var r=Date.parse(t);return isNaN(r)?null:new Date(r)}function u(t){var e=t.polyfill?t.xtag.polyfillInput:t.xtag.dateInput,n=l(e.value);return n?t.removeAttribute("invalid"):t.setAttribute("invalid",!0),!!n}function c(t,e){var n=t.polyfill?t.xtag.polyfillInput:t.xtag.dateInput,r=n.value,i=l(r);t.value=e&&i?i:r}function d(t,e,n){var r=t.submitValue,i=t.value;e();var o=t.submitValue,a=t.value;(r!==o||n&&i!==a)&&xtag.fireEvent(t,"change")}function f(t){var e=t.xtag._labels;return new Array(5).join(e.yearAbbr)+"-"+new Array(3).join(e.monthAbbr)+"-"+new Array(3).join(e.dayAbbr)}var h=13,p=document.createElement("x-calendar").labels,v=/(\d{4})[^\d]?(\d{2})[^\d]?(\d{2})/;xtag.register("x-datepicker",{lifecycle:{created:function(){this.innerHTML="";var e=document.createElement("input");e.setAttribute("type","date"),xtag.addClass(e,"x-datepicker-input"),this.appendChild(e),this.xtag.dateInput=e,this.xtag._labels={yearAbbr:"Y",monthAbbr:"M",dayAbbr:"D"},this.xtag._polyfillCalLabels=t(p),this.xtag.polyfillInput=null,this.xtag.polyfillUI=null,this.polyfill=this.hasAttribute("polyfill")||"date"!==e.type.toLowerCase()}},events:{"datetoggleon:delegate(x-calendar)":function(t){var e=t.currentTarget;if(t.detail&&t.detail.date){var n=l(t.detail.date);d(e,function(){e.value=n?a(n):"",xtag.fireEvent(e,"input")})}},"datetoggleoff:delegate(x-calendar)":function(t){t.currentTarget.value=null},focus:function(t){t.currentTarget.setAttribute("focused",!0)},"blur:delegate(.x-datepicker-input)":function(t){t.currentTarget.removeAttribute("focused")},"blur:delegate(.x-datepicker-polyfill-input)":function(t){var e=t.currentTarget;e.removeAttribute("focused"),d(e,function(){c(e,!0)},!0)},"touchstart:delegate(.x-datepicker-polyfill-input)":function(){this.setAttribute("readonly",!0)},"tapstart:delegate(x-calendar)":function(t){t.preventDefault()},"keypress:delegate(.x-datepicker-polyfill-input)":function(t){var e=t.keyCode,n=t.currentTarget;e===h&&d(n,function(){c(n,!0)},!0)},"input:delegate(.x-datepicker-input)":function(t){var e=t.currentTarget;d(e,function(){c(e,!0),t.stopPropagation(),xtag.fireEvent(e,"input")})},"input:delegate(.x-datepicker-polyfill-input)":function(t){var e=t.currentTarget;d(e,function(){c(e,!1),t.stopPropagation(),xtag.fireEvent(e,"input")})},"change:delegate(.x-datepicker-input)":function(t){t.stopPropagation(),xtag.fireEvent(t.currentTarget,"change")},"change:delegate(.x-datepicker-polyfill-input)":function(t){t.stopPropagation();var e=t.currentTarget;d(e,function(){c(e,!1)})}},accessors:{name:{attribute:{selector:".x-datepicker-input"},set:function(t){var e=this.xtag.dateInput;null===t||void 0===t?e.removeAttribute("name"):e.setAttribute("name",t)}},submitValue:{get:function(){return this.xtag.dateInput.value}},value:{attribute:{skip:!0},get:function(){return this.polyfill?this.xtag.polyfillInput.value:this.xtag.dateInput.value},set:function(t){var e=l(t),n=e?a(e):null,r=this.xtag.dateInput,i=this.xtag.polyfillInput,o=this.xtag.polyfillUI;if(null===t||void 0===t)this.removeAttribute("value"),r.value="",i&&(i.value=""),o&&(o.chosen=null);else{var s,c=n?n:t;i?t!==i.value?(i.value=c,s=c):s=t:s=c,this.setAttribute("value",s),n?(r.value=n,o&&(o.chosen=e,o.view=e)):(r.value="",o&&(o.chosen=null))}u(this)}},polyfill:{attribute:{"boolean":!0},set:function(t){var e=this.xtag.dateInput;if(t){if(e.setAttribute("type","hidden"),e.setAttribute("readonly",!0),!this.xtag.polyfillInput){var n=document.createElement("input");xtag.addClass(n,"x-datepicker-polyfill-input"),n.setAttribute("type","text"),n.setAttribute("placeholder",f(this)),n.value=this.xtag.dateInput.value,this.xtag.polyfillInput=n,this.appendChild(n)}if(this.xtag.polyfillInput.removeAttribute("disabled"),!this.xtag.polyfillUI){var r=document.createElement("x-calendar");xtag.addClass(r,"x-datepicker-polyfill-ui"),r.chosen=this.value,r.view=this.xtag.dateInput.value,r.controls=!0,r.labels=this.xtag._polyfillCalLabels,this.xtag.polyfillUI=r,this.appendChild(r)}}else{e.setAttribute("type","date"),e.removeAttribute("readonly");var i=this.xtag.polyfillInput;i&&i.setAttribute("disabled",!0)}}},labels:{get:function(){var e={},n=this.xtag._labels,r=this.xtag._polyfillCalLabels;for(var i in n)e[i]=n[i];for(var i in r)e[i]=r[i];return t(e)},set:function(t){var e=this.xtag.polyfillUI,n=this.xtag.polyfillInput;if(e)e.labels=t,this.xtag._polyfillCalLabels=e.labels;else{var r=this.xtag._polyfillCalLabels;for(var i in r)i in t&&(r[i]=t[i])}var o=this.xtag._labels;for(var i in o)i in t&&(o[i]=t[i]);n&&n.setAttribute("placeholder",f(this))}}}})}();