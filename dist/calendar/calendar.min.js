!function(){function e(e,t){e.appendChild(t)}function t(e){return parseInt(e,10)}function n(e){var n=t(e);return n===e&&!isNaN(n)&&n>=0&&6>=n}function r(e){return e instanceof Date&&!!e.getTime&&!isNaN(e.getTime())}function o(e){return e&&e.isArray?e.isArray():"[object Array]"===Object.prototype.toString.call(e)}function i(e){var t=e.split("."),n=t.shift(),r=document.createElement(n);return r[W]=t.join(" "),r}function a(e){var t=e.getBoundingClientRect(),n=document.documentElement,r=n.scrollTop||document.body.scrollTop||0,o=n.scrollLeft||document.body.scrollLeft||0;return{left:t.left+o,right:t.right+o,top:t.top+r,bottom:t.bottom+r,width:t.width,height:t.height}}function s(e,t){xtag.addClass(e,t)}function c(e,t){xtag.removeClass(e,t)}function u(e,t){return xtag.hasClass(e,t)}function l(e){return e.getUTCFullYear()}function d(e){return e.getUTCMonth()}function f(e){return e.getUTCDate()}function h(e){return e.getUTCDay()}function p(e,t){var n=e.toString(),r=new Array(t).join("0");return(r+n).substr(-t)}function v(e){return[p(l(e),4),p(d(e)+1,2),p(f(e),2)].join("-")}function m(e){if(r(e))return e;var t=z.exec(e);return t?new Date(t[1],t[2]-1,t[3]):null}function g(e){if(r(e))return e;var t=m(e);if(t)return t;var n=Date.parse(e);return isNaN(n)?null:new Date(n)}function b(e){var t;if(o(e))t=e.slice(0);else{if(r(e))return[e];if(!("string"==typeof e&&e.length>0))return null;try{if(t=JSON.parse(e),!o(t))return console.warn("invalid list of ranges",e),null}catch(n){var i=g(e);return i?[i]:(console.warn("unable to parse",e,"as JSON or single date"),null)}}for(var a=0;a<t.length;a++){var s=t[a];if(!r(s))if("string"==typeof s){var c=g(s);if(!c)return console.warn("unable to parse date",s),null;t[a]=c}else{if(!o(s)||2!==s.length)return console.warn("invalid range value: ",s),null;var u=g(s[0]);if(!u)return console.warn("unable to parse start date",s[0],"from range",s),null;var l=g(s[1]);if(!l)return console.warn("unable to parse end date",s[1],"from range",s),null;if(u.valueOf()>l.valueOf())return console.warn("invalid range",s,": start date is after end date"),null;t[a]=[u,l]}}return t}function _(e,t,n,r){return void 0===t&&(t=l(e)),void 0===n&&(n=d(e)),void 0===r&&(r=f(e)),new Date(t,n,r)}function y(e,t,n,r){return _(e,l(e)+t,d(e)+n,f(e)+r)}function w(e,r){r=t(r),n(r)||(r=0);for(var o=0;7>o;o++){if(h(e)===r)return e;e=L(e)}throw"unable to find week start"}function E(e,r){r=t(r),n(r)||(r=6);for(var o=0;7>o;o++){if(h(e)===r)return e;e=N(e)}throw"unable to find week end"}function x(e){return e=new Date(e.valueOf()),e.setDate(1),e}function O(e){return L(y(e,0,1,0))}function N(e){return y(e,0,0,1)}function L(e){return y(e,0,0,-1)}function A(e,t){if(t){t=void 0===t.length?[t]:t;var n=!1;return t.forEach(function(t){2===t.length?k(t[0],t[1],e)&&(n=!0):v(t)===v(e)&&(n=!0)}),n}}function k(e,t,n){return v(e)<=v(n)&&v(n)<=v(t)}function M(e){e.sort(function(e,t){var n=r(e)?e:e[0],o=r(t)?t:t[0];return n.valueOf()-o.valueOf()})}function T(t){var n=i("div.controls"),r=i("span.prev"),o=i("span.next");return r.innerHTML=t.prev,o.innerHTML=t.next,e(n,r),e(n,o),n}function C(e){var t=this;e=e||{},t._span=e.span||1,t._multiple=e.multiple||!1,t._viewDate=t._getSanitizedViewDate(e.view,e.chosen),t._chosenRanges=t._getSanitizedChosenRanges(e.chosen,e.view),t._firstWeekdayNum=e.firstWeekdayNum||0,t._el=i("div.calendar"),t._labels=U(),t._customRenderFn=null,t._renderRecursionFlag=!1,t.render(!0)}function D(e){e=e.slice(0),M(e);for(var t=[],n=0;n<e.length;n++){var o,i,a,s,c=e[n],u=t.length>0?t[t.length-1]:null;if(r(c)?o=i=c:(o=c[0],i=c[1]),c=A(o,i)?o:[o,i],r(u))a=s=u;else{if(!u){t.push(c);continue}a=u[0],s=u[1]}if(A(o,[u])||A(L(o),[u])){var l=a.valueOf()<o.valueOf()?a:o,d=s.valueOf()>i.valueOf()?s:i,f=A(l,d)?l:[l,d];t[t.length-1]=f}else t.push(c)}return t}function S(e,t){var n,r=t.getAttribute("data-date"),o=g(r);u(t,q)?(e.xtag.dragType=V,n="datetoggleoff"):(e.xtag.dragType=I,n="datetoggleon"),e.xtag.dragStartEl=t,e.xtag.dragAllowTap=!0,e.noToggle||xtag.fireEvent(e,n,{detail:{date:o,iso:r}}),e.setAttribute("active",!0),t.setAttribute("active",!0)}function j(e,t){var n=t.getAttribute("data-date"),r=g(n);t!==e.xtag.dragStartEl&&(e.xtag.dragAllowTap=!1),e.noToggle||(e.xtag.dragType!==I||u(t,q)?e.xtag.dragType===V&&u(t,q)&&xtag.fireEvent(e,"datetoggleoff",{detail:{date:r,iso:n}}):xtag.fireEvent(e,"datetoggleon",{detail:{date:r,iso:n}})),e.xtag.dragType&&t.setAttribute("active",!0)}function R(){for(var e=xtag.query(document,"x-calendar"),t=0;t<e.length;t++){var n=e[t];n.xtag.dragType=null,n.xtag.dragStartEl=null,n.xtag.dragAllowTap=!1,n.removeAttribute("active")}for(var r=xtag.query(document,"x-calendar .day[active]"),o=0;o<r.length;o++)r[o].removeAttribute("active")}function F(e,t,n){return n.left<=e&&e<=n.right&&n.top<=t&&t<=n.bottom}var P=0,U=function(){return{prev:"<",next:">",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]}},H=new Date;H.setHours(0),H.setMinutes(0),H.setSeconds(0),H.setMilliseconds(0);var I="add",V="remove",q="chosen",W="className",z=/(\d{4})[^\d]?(\d{2})[^\d]?(\d{2})/,J=C.prototype;J.makeMonth=function(t){if(!r(t))throw"Invalid view date!";var n=this.firstWeekdayNum,o=this.chosen,a=this.labels,c=d(t),u=w(x(t),n),h=i("div.month"),p=i("div.month-label");p.textContent=a.months[c]+" "+l(t),e(h,p);for(var m=i("div.weekday-labels"),g=0;7>g;g++){var b=(n+g)%7,_=i("span.weekday-label");_.textContent=a.weekdays[b],e(m,_)}e(h,m);for(var y=i("div.week"),E=u,O=!1,L=42,g=0;!O&&L>g;){g++;var k=i("span.day");k.setAttribute("data-date",v(E)),k.textContent=f(E),d(E)!==c&&s(k,"badmonth"),A(E,o)&&s(k,q),A(E,H)&&s(k,"today"),e(y,k),E=N(E),0===g%7&&g>0&&(e(h,y),y=i("div.week"),O=d(E)>c||d(E)<c&&l(E)>l(u))}return h},J._getSanitizedViewDate=function(e,t){if(t=void 0===t?this.chosen:t,r(e))return e;if(r(t))return t;if(o(t)&&t.length>0){var n=t[0];return r(n)?n:n[0]}return H},J._getSanitizedChosenRanges=function(e,t){t=void 0===t?this.view:t;var n;n=r(e)?[e]:o(e)?e:null!==e&&void 0!==e&&t?[t]:[];var i=D(n);if(!this.multiple&&i.length>0){var a=i[0];return r(a)?[a]:[a[0]]}return i},J.addDate=function(e,t){r(e)&&(t?(this.chosen.push(e),this.chosen=this.chosen):this.chosen=[e])},J.removeDate=function(e){if(r(e))for(var t=this.chosen.slice(0),n=0;n<t.length;n++){var i=t[n];if(A(e,[i])){if(t.splice(n,1),o(i)){var a=i[0],s=i[1],c=L(e),u=N(e);A(c,[i])&&t.push([a,c]),A(u,[i])&&t.push([u,s])}this.chosen=D(t);break}}},J.hasChosenDate=function(e){return A(e,this._chosenRanges)},J.hasVisibleDate=function(e,t){var n=t?this.firstVisibleMonth:this.firstVisibleDate,r=t?O(this.lastVisibleMonth):this.lastVisibleDate;return A(e,[[n,r]])},J.render=function(t){var n,r=this._span;if(t){var o,i=xtag.query(this.el,".day");for(n=0;n<i.length;n++)if(o=i[n],o.hasAttribute("data-date")){var a=o.getAttribute("data-date"),u=m(a);u&&(A(u,this._chosenRanges)?s(o,q):c(o,q),A(u,[H])?s(o,"today"):c(o,"today"))}}else{this.el.innerHTML="";var l=this.firstVisibleMonth;for(n=0;r>n;n++)e(this.el,this.makeMonth(l)),l=y(l,0,1,0)}this._callCustomRenderer()},J._callCustomRenderer=function(){if(this._customRenderFn){if(this._renderRecursionFlag)throw"Error: customRenderFn causes recursive loop of rendering calendar; make sure your custom rendering function doesn't modify attributes of the x-calendar that would require a re-render!";for(var e=xtag.query(this.el,".day"),t=0;t<e.length;t++){var n=e[t],r=n.getAttribute("data-date"),o=m(r);this._renderRecursionFlag=!0,this._customRenderFn(n,o?o:null,r),this._renderRecursionFlag=!1}}},Object.defineProperties(J,{el:{get:function(){return this._el}},multiple:{get:function(){return this._multiple},set:function(e){this._multiple=e,this.chosen=this._getSanitizedChosenRanges(this.chosen),this.render(!0)}},span:{get:function(){return this._span},set:function(e){var n=t(e);this._span=!isNaN(n)&&n>=0?n:0,this.render(!1)}},view:{attribute:{},get:function(){return this._viewDate},set:function(e){var t=this._getSanitizedViewDate(e),n=this._viewDate;this._viewDate=t,this.render(d(n)===d(t)&&l(n)===l(t))}},chosen:{get:function(){return this._chosenRanges},set:function(e){this._chosenRanges=this._getSanitizedChosenRanges(e),this.render(!0)}},firstWeekdayNum:{get:function(){return this._firstWeekdayNum},set:function(e){e=t(e),n(e)||(e=0),this._firstWeekdayNum=e,this.render(!1)}},lastWeekdayNum:{get:function(){return(this._firstWeekdayNum+6)%7}},customRenderFn:{get:function(){return this._customRenderFn},set:function(e){this._customRenderFn=e,this.render(!0)}},chosenString:{get:function(){if(this.multiple){for(var e=this.chosen.slice(0),t=0;t<e.length;t++){var n=e[t];e[t]=r(n)?v(n):[v(n[0]),v(n[1])]}return JSON.stringify(e)}return this.chosen.length>0?v(this.chosen[0]):""}},firstVisibleMonth:{get:function(){return x(y(this.view,0,-Math.floor(this.span/2),0))}},lastVisibleMonth:{get:function(){return y(this.firstVisibleMonth,0,Math.max(0,this.span-1),0)}},firstVisibleDate:{get:function(){return w(this.firstVisibleMonth,this.firstWeekdayNum)}},lastVisibleDate:{get:function(){return E(O(this.lastVisibleMonth),this.lastWeekdayNum)}},labels:{get:function(){return this._labels},set:function(e){var t=this.labels;for(var n in t)if(n in e){var r=this._labels[n],i=e[n];if(o(r)){if(!o(i)||r.length!==i.length)throw"invalid label given for '"+n+"': expected array of "+r.length+" labels, got "+JSON.stringify(i);i=i.slice(0);for(var a=0;a<i.length;a++)i[a]=i[a].toString?i[a].toString():String(i[a])}else i=String(i);t[n]=i}this.render(!1)}}});var Y=null,X=null;xtag.register("x-calendar",{lifecycle:{created:function(){this.innerHTML="";var t=this.getAttribute("chosen");this.xtag.calObj=new C({span:this.getAttribute("span"),view:g(this.getAttribute("view")),chosen:b(t),multiple:this.hasAttribute("multiple"),firstWeekdayNum:this.getAttribute("first-weekday-num")}),e(this,this.xtag.calObj.el),this.xtag.calControls=null,this.xtag.dragType=null,this.xtag.dragStartEl=null,this.xtag.dragAllowTap=!1},inserted:function(){Y||(Y=xtag.addEvent(document,"mouseup",R)),X||(X=xtag.addEvent(document,"touchend",R)),this.render(!1)},removed:function(){0===xtag.query(document,"x-calendar").length&&(Y&&(xtag.removeEvent(document,"mouseup",Y),Y=null),X&&(xtag.removeEvent(document,"touchend",X),X=null))}},events:{"tap:delegate(.next)":function(e){var t=e.currentTarget;t.nextMonth(),xtag.fireEvent(t,"nextmonth")},"tap:delegate(.prev)":function(e){var t=e.currentTarget;t.prevMonth(),xtag.fireEvent(t,"prevmonth")},"tapstart:delegate(.day)":function(e){(e.touches||!e.button||e.button===P)&&(e.preventDefault(),e.baseEvent&&e.baseEvent.preventDefault(),S(e.currentTarget,this))},touchmove:function(e){if(e.touches&&e.touches.length>0){var t=e.currentTarget;if(t.xtag.dragType)for(var n=e.touches[0],r=xtag.query(t,".day"),o=0;o<r.length;o++){var i=r[o];F(n.pageX,n.pageY,a(i))?j(t,i):i.removeAttribute("active")}}},"mouseover:delegate(.day)":function(e){var t=e.currentTarget,n=this;j(t,n)},"mouseout:delegate(.day)":function(){var e=this;e.removeAttribute("active")},"tapend:delegate(.day)":function(e){var t=e.currentTarget;if(t.xtag.dragAllowTap){var n=this,r=n.getAttribute("data-date"),o=g(r);xtag.fireEvent(t,"datetap",{detail:{date:o,iso:r}})}},datetoggleon:function(e){var t=this;t.toggleDateOn(e.detail.date,t.multiple)},datetoggleoff:function(e){var t=this;t.toggleDateOff(e.detail.date)}},accessors:{controls:{attribute:{"boolean":!0},set:function(t){t&&!this.xtag.calControls&&(this.xtag.calControls=T(this.xtag.calObj.labels),e(this,this.xtag.calControls))}},multiple:{attribute:{"boolean":!0},get:function(){return this.xtag.calObj.multiple},set:function(e){this.xtag.calObj.multiple=e,this.chosen=this.chosen}},span:{attribute:{},get:function(){return this.xtag.calObj.span},set:function(e){this.xtag.calObj.span=e}},view:{attribute:{},get:function(){return this.xtag.calObj.view},set:function(e){var t=g(e);t&&(this.xtag.calObj.view=t)}},chosen:{attribute:{skip:!0},get:function(){var e=this.xtag.calObj.chosen;if(this.multiple)return this.xtag.calObj.chosen;if(e.length>0){var t=e[0];return r(t)?t:t[0]}return null},set:function(e){var t=this.multiple?b(e):g(e);this.xtag.calObj.chosen=t?t:null,this.xtag.calObj.chosenString?this.setAttribute("chosen",this.xtag.calObj.chosenString):this.removeAttribute("chosen")}},firstWeekdayNum:{attribute:{name:"first-weekday-num"},set:function(e){this.xtag.calObj.firstWeekdayNum=e}},noToggle:{attribute:{"boolean":!0,name:"notoggle"},set:function(e){e&&(this.chosen=null)}},firstVisibleMonth:{get:function(){return this.xtag.calObj.firstVisibleMonth}},lastVisibleMonth:{get:function(){return this.xtag.calObj.lastVisibleMonth}},firstVisibleDate:{get:function(){return this.xtag.calObj.firstVisibleDate}},lastVisibleDate:{get:function(){return this.xtag.calObj.lastVisibleDate}},customRenderFn:{get:function(){return this.xtag.calObj.customRenderFn},set:function(e){this.xtag.calObj.customRenderFn=e}},labels:{get:function(){return JSON.parse(JSON.stringify(this.xtag.calObj.labels))},set:function(e){this.xtag.calObj.labels=e;var t=this.xtag.calObj.labels,n=this.querySelector(".controls > .prev");n&&(n.textContent=t.prev);var r=this.querySelector(".controls > .next");r&&(r.textContent=t.next)}}},methods:{render:function(e){this.xtag.calObj.render(e)},prevMonth:function(){var e=this.xtag.calObj;e.view=y(e.view,0,-1,0)},nextMonth:function(){var e=this.xtag.calObj;e.view=y(e.view,0,1,0)},toggleDateOn:function(e,t){this.xtag.calObj.addDate(e,t),this.chosen=this.chosen},toggleDateOff:function(e){this.xtag.calObj.removeDate(e),this.chosen=this.chosen},toggleDate:function(e,t){this.xtag.calObj.hasChosenDate(e)?this.toggleDateOff(e):this.toggleDateOn(e,t)},hasVisibleDate:function(e,t){return this.xtag.calObj.hasVisibleDate(e,t)}}})}();