<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="x-tag-components.css"/>
    <link rel="stylesheet" type="text/css" href="../src/tooltip.css"/>
    
    <script type="text/javascript" src="x-tag-components.js"></script>
    <script type="text/javascript" src="../src/tooltip.js"></script>
    <style>
        body, html{
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        
        #container{
            border: 1px solid grey;
            margin: 0 auto;
            width: 320px;
            height: 480px;
            position: relative;
        }
        
        #prev-sib{
            position: relative;
            margin: 1em;
            border: 1px solid grey;
            overflow: visible;
        }
        
        #next-sib{
            margin-top: 10em;
            background-color: cyan; 
            position: relative;
        }
        
        .fancy-selector{
            position: relative;
            display: inline-block;
            background-color: lightsteelblue;
            font-size: 1.2em;
            margin:.15em;
        }
        
        /* arrow is always in relation to content, so modify borders here instead
           of in the content element
           
           any border or background styles here will be inherited by the tooltip arrow
        */
        #demoTip{
            border-radius: 4px;
            border: 2px solid black;
            background: orange url('cream_pixels.png') center repeat repeat;
        }
        
        #demoTip > .tooltip-content{
            padding: .5em;
            font-family: Courier;
        }
        
        /** users can apply custom styles using this attribute for anything
         ** with a tooltip attached **/
        [x-tooltip-targeted]{
            box-shadow: 1px 1px 10px goldenrod;
        }
        
        /** example usage: attaching a tooltip indicator to elements **/
        [x-tooltip-targeted]:after{
            content: "!";
            position: absolute;
            right: -7px;
            bottom: -7px;
            background-color: red;
            color: white;
            font-size: 1.1em;
            border: 1px solid white;
            box-shadow: 1px 1px 4px grey;
            border-radius: 100%;
            width: 20px;
            height: 20px;
            text-align: center;
        }
        
        #controls{
            text-align: center;
        }
    </style>
</head>
<body>
<h1>X-ToolTip demo</h1>
<div id="container">
    parent node
    <button id="prev-sib">
        <p style="background-color: tomato;">prev sibling
            <img src="http://placekitten.com/100/50"/>
        </p>
    </button>
    <x-tooltip id="demoTip" target-selector="_nextSibling">
        <span class="fancy-selector">Hi!</span>I'm a tooltip! <img src="http://placekitten.com/30"/>
        <br/><a href="http://google.com">Check out this link!</a>
    </x-tooltip>
    <div id="next-sib">
        <h1>Next sibling</h1>
    </div>
    <div style="position: relative; background-color: lavender">    
        <span class="fancy-selector">".fancy-selector" box1</span>
        <span class="fancy-selector">box2</span>
    </div>
</div>


<div id="controls">
    <button onClick="changeOrientation()">Change orientation</button>
    <button onClick="toggleTooltip(event)">Toggle tooltip</button>
    <button onClick="toggleSelector()">Toggle selector</button>
    <button onClick="toggleTriggerStyle()">Toggle trigger style</button>
    <button onClick="changeContents(event)">Change tooltip contents</button>
    <br/>
    <span>Current selector = <span id="curr-selector-status"></span></span>
    <br/>
    <span>Current orientation = <span id="curr-orient-status"></span></span>
    <br/>
    <span>Current trigger style = <span id="curr-trigger-style-status"></span></span>
</div>
<script>
var demoTip;
document.addEventListener('DOMComponentsLoaded', function(){
    demoTip = document.getElementById("demoTip");
    updateStatuses();
    
    demoTip.addEventListener("tooltipshown", function(e){
        console.log("tooltip shown!");
    });
    
    demoTip.addEventListener("tooltiphidden", function(e){
        console.log("tooltip hidden!");
    });
});

function changeOrientation(){
    var orients = ["auto", "top", "right", "bottom", "left"];
    var currOrient = demoTip.orientation;
    
    var currIndex = orients.indexOf(currOrient);
    
    demoTip.setAttribute("orientation", orients[(currIndex+1) % orients.length]);
    updateStatuses();
}

function toggleTooltip(e){
    demoTip.toggle();
    e.stopPropagation();
}

function toggleSelector(){
    var selectors = ["_previousSibling", "_nextSibling", ".fancy-selector"];
    var currSelector = demoTip.targetSelector;
    
    var currIndex = selectors.indexOf(currSelector);
    
    demoTip.targetSelector = selectors[(currIndex+1) % selectors.length];
    updateStatuses();
}

function toggleTriggerStyle(){
    var styles = ["hover", "click", "touchstart", "tap", "none"];
    var currStyle = demoTip.triggerStyle;
    
    var currIndex = styles.indexOf(currStyle);
    
    demoTip.triggerStyle = styles[(currIndex+1) % styles.length];
    
    updateStatuses();
}

function updateStatuses(){
    updateSelectorBox();
    updateOrientationBox();
    updateTriggerStyleBox();
}

function updateSelectorBox(){
    var statusBox = document.getElementById("curr-selector-status");
    
    statusBox.textContent = demoTip.targetSelector;
}

function updateOrientationBox(){
    var statusBox = document.getElementById("curr-orient-status");
    
    statusBox.textContent = demoTip.orientation;
}

function updateTriggerStyleBox(){
    var triggerStyleBox = document.getElementById("curr-trigger-style-status");
    
    triggerStyleBox.textContent = demoTip.triggerStyle;
    
    if(demoTip.presetTriggerStyles.indexOf(demoTip.triggerStyle) !== -1){
        triggerStyleBox.textContent += "  (preset style)";
    }
}

function randomKittenUrl(){
    var catNumber = Math.floor(Math.random() * 15 + 1);
    
    return "http://placekitten.com/50/?image="+catNumber;
}

var changeContents = (function(){
    var currIndex = 0;
    var htmlStrs = [
        document.getElementById("demoTip").innerHTML,
        "Text text text text",
        "<img src='test.png'/>",
        "<img src='test.gif'/>",
        (function(){
            var aCode = "A".charCodeAt(0);
            var letters = [];
            for(var i=0; i < 10; i++){
                letters.push(String.fromCharCode(aCode+i));
            }
            return letters.join("<hr/>");
        })()
    ];
    
    return function(e){
        e.stopPropagation();
        
        var contentEl = demoTip.content;
        
        var newIndex = (currIndex+1) % htmlStrs.length;
        currIndex = newIndex;
        var newHtml = htmlStrs[newIndex];
        
        // set up a temporary holding element to load images in
        var container = document.createElement("div");
        container.innerHTML = newHtml;
        
        var imgs = container.querySelectorAll("img");
        var numImgs = imgs.length;
        var loadedImgs = 0;
        
        // copy over html from the temp container to the content element and
        // trigger a refresh
        var _onContainerReady = function(){
            contentEl.innerHTML = container.innerHTML;
            demoTip.refreshPosition();
        };
        
        if(numImgs === 0){
            _onContainerReady();
        }
        else{
            // wait for any images to load before setting the content's html
            var _onImgLoaded = function(){
                loadedImgs += 1;
                if(loadedImgs === numImgs){
                    _onContainerReady();
                }
            };
        
            imgs.forEach(function(img){
                if(img.complete){
                    _onImgLoaded();
                }
                else{
                    img.onload = _onImgLoaded;
                }
            });
        }
    }
})();
</script>
</body>
</html>